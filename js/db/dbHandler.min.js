var db;window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;function dbConn(){let a=window.indexedDB.open("tmTimerDB",1);a.onerror=function(a){console.log("Database error code: "+a.target.errorCode)},a.onsuccess=function(){if(db=a.result,isNewMeeting())clearTimetable();else{let a=db.transaction(["timeTable"],"readonly").objectStore("timeTable").count();a.onsuccess=function(){0===a.result&&restoreData()}}},a.onupgradeneeded=function(a){let b=a.currentTarget.result.createObjectStore("timeTable",{keyPath:"id",autoIncrement:!0});b.createIndex("member","member",{unique:!1}),b.createIndex("role","role",{unique:!1}),b.createIndex("min","min",{unique:!1}),b.createIndex("opt","opt",{unique:!1}),b.createIndex("max","max",{unique:!1}),b.createIndex("time","time",{unique:!1}),b.createIndex("lastColor","lastColor",{unique:!1}),b.createIndex("disqualified","disqualified",{unique:!1})}}function initializeDB(a,b){if(b!==a)try{window.indexedDB.deleteDatabase("tmTimerDB")}catch(a){}dbConn()}function clearTimetable(){var a=db.transaction(["timeTable"],"readwrite").objectStore("timeTable").clear();a.onsuccess=function(){saveData()}}function isNewMeeting(){let a=moment(new Date).format("YYYY/MM/DD");return null===getLocalStorageValue("meetingDate")?(setLocalStorage("meetingDate",a),!0):getLocalStorageValue("meetingDate")!==a&&(removeLocalStorage("meetingDate"),setLocalStorage("meetingDate",a),!0)}function addNewTime(a,b,c,d,e,f,g,h){if("Invalid date"!==f&&("white"!==g||e!==f)){let i=db.transaction(["timeTable"],"readwrite").objectStore("timeTable").add({member:a,role:b,min:c,opt:d,max:e,time:f,lastColor:g,disqualified:h});i.onsuccess=function(){saveData(),showSnackbar(lngObject.recorded)}}}function restoreData(){if(moment(new Date).format("YYYY/MM/DD")===getLocalStorageValue("backUpDate"))for(let a in JSON.parse(`[${getLocalStorageValue("backUpTT")}]`))addNewTime(a.member,a.role,a.min,a.opt,a.max,a.time,a.lastColor,a.disqualified)}function saveData(){let a=db.transaction(["timeTable"],"readwrite").objectStore("timeTable").openCursor(),b=[];a.onsuccess=function(a){let c=a.target.result;c?(b.push(JSON.stringify(c.value)),c.continue()):(setLocalStorage("backUpDate",moment(new Date).format("YYYY/MM/DD")),setLocalStorage("backUpTT",b))}}